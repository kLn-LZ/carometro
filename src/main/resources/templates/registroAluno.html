<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
	<link rel="stylesheet" href="/css/registroAluno.css">
    <meta charset="UTF-8">
    <title>Registro de Aluno - Carômetro</title>
</head>
<body>
<h1 th:text="${alunoDTO.id == null} ? 'Registro de Aluno - Carômetro' : 'Editar Aluno - Carômetro'"></h1>
<p th:if="${error}" class="error" th:text="${error}"></p>

<div  th:if="${alunoDTO.status == T(com.fatec.carometro.Entities.StatusValidacao).REPROVADO and alunoDTO.descricaoReprovacao != null}"
     style="color: red; margin-bottom: 1em;">
    <p><strong>Status do Perfil:</strong> Reprovado</p>
    <p><strong>Justificativa:</strong> <span th:text="${alunoDTO.descricaoReprovacao}"></span></p>
</div>

<form th:action="@{/registroAluno}" th:object="${alunoDTO}" method="post" enctype="multipart/form-data">
    <input type="hidden" th:field="*{id}" />

    <h2>Foto</h2>
    <label for="foto">Foto (Sozinho ou em Família):</label>
    <input type="file" id="foto" name="foto" accept="image/*" th:required="${alunoDTO.id == null}" onchange="previewImage(event)">
    <span class="field-error" th:if="${#fields.hasErrors('foto')}" th:errors="*{foto}"></span><br>
    <img id="fotoPreview" th:src="${alunoDTO.fotoBase64 != null} ? 'data:image/jpeg;base64,' + ${alunoDTO.fotoBase64} : ''" alt="Pré-visualização da Foto" th:style="${alunoDTO.fotoBase64 != null} ? 'display: block' : 'display: none'">

    <h2>Dados Pessoais</h2>
    <label for="nome">Nome:</label>
    <input type="text" id="nome" th:field="*{nome}" required>
    <span class="field-error" th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}"></span><br>

    <label for="cursoId">Curso:</label>
    <select id="cursoId" th:field="*{cursoId}" required>
        <option value="">Selecione um curso</option>
        <option th:each="curso : ${cursos}"
                th:value="${curso.id}"
                th:text="${curso.nome}"
                th:selected="${curso.id == alunoDTO.cursoId}"></option>
    </select>
    <span class="field-error" th:if="${#fields.hasErrors('cursoId')}" th:errors="*{cursoId}"></span><br>

    <label for="ano">Ano:</label>
    <input type="number" id="ano" th:field="*{ano}" required>
    <span class="field-error" th:if="${#fields.hasErrors('ano')}" th:errors="*{ano}"></span><br>

    <h2>Links</h2>
    <label for="linkedIn">LinkedIn:</label>
    <input type="url" id="linkedIn" th:field="*{linkedIn}">
    <span class="field-error" th:if="${#fields.hasErrors('linkedIn')}" th:errors="*{linkedIn}"></span><br>

    <label for="gitHub">GitHub:</label>
    <input type="url" id="gitHub" th:field="*{gitHub}">
    <span class="field-error" th:if="${#fields.hasErrors('gitHub')}" th:errors="*{gitHub}"></span><br>

    <label for="lattes">Lattes:</label>
    <input type="url" id="lattes" th:field="*{lattes}">
    <span class="field-error" th:if="${#fields.hasErrors('lattes')}" th:errors="*{lattes}"></span><br>

    <h2>Histórico</h2>
    <label for="historico">Histórico (Onde estudou, o que fez lá, e quanto tempo estudou):</label>
    <textarea id="historico" th:field="*{historico}" required></textarea>
    <span class="field-error" th:if="${#fields.hasErrors('historico')}" th:errors="*{historico}"></span><br>

    <h2>Comentários</h2>
    <label for="comentarios">Comentários (Apenas na FATEC):</label>
    <textarea id="comentarios" th:field="*{comentarios}" required></textarea>
    <span class="field-error" th:if="${#fields.hasErrors('comentarios')}" th:errors="*{comentarios}"></span><br>

    <h2>Consentimento</h2>
    <label for="consentePublicacao">Concordo com a publicação das minhas informações:</label>
    <input type="checkbox" id="consentePublicacao" th:field="*{consentePublicacao}" required>
    <span class="field-error" th:if="${#fields.hasErrors('consentePublicacao')}" th:errors="*{consentePublicacao}"></span><br>

    <button type="submit">Registrar</button>
</form>
<p th:if="${param.success}">Registro concluído com sucesso! Seu perfil está aguardando aprovação.</p>

<script>
    function previewImage(event) {
        const input = event.target;
        const preview = document.getElementById('fotoPreview');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(input.files[0]);
        } else {
            preview.src = '';
            preview.style.display = 'none';
        }
    }
</script>
</body>
</html>